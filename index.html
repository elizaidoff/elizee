<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>האתר שלי - דף יחיד</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* הגדרת פונט Inter כברירת מחדל */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f0f0; /* רקע כללי בהיר */
            transition: background-image 0.5s ease-in-out; /* אנימציה לרקע */
            background-size: cover;
            background-position: center;
        }
        /* סגנון כללי לקישורים בכפתורים */
        .button-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: white;
            padding: 1rem;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
            transition: box-shadow 300ms ease-in-out;
            text-decoration: none; /* הסרת קו תחתון מקישור */
            color: inherit; /* ירושה של צבע הטקסט */
            cursor: pointer; /* כדי לציין שזה לחיץ */
        }
        .button-link:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* hover:shadow-lg */
        }
        /* הסתרת דפים כברירת מחדל */
        .page-content {
            display: none;
        }
        /* הצגת הדף הפעיל */
        .page-content.active {
            display: block;
        }
        /* סגנון למודאל */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7); /* רקע שחור חצי שקוף */
        }
        .modal-content {
            max-height: 90vh; /* גובה מקסימלי של המודאל */
            overflow: hidden; /* כדי לאפשר גלילה רק לתוכן הפוסט */
        }
        .modal-body {
            overflow-y: auto; /* גלילה אנכית לתוכן הפוסט */
            flex-grow: 1; /* יתפוס כמה שיותר מקום במודאל */
        }
        /* סגנון לתמונות בפוסטים */
        .post-image {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1rem auto; /* שוליים אוטומטיים למרכוז */
            object-fit: contain; /* תמונה תוצג במלואה */
        }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MEXP0GHFC4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-MEXP0GHFC4');
    </script>
</head>
<body class="flex flex-col min-h-screen">

    <!-- כותרת עליונה עם רקע חצי שקוף - משותפת לכל הדפים -->
    <header class="text-white p-6 text-center relative">
        <!-- כפתור חזרה לדף הבית (מוצג רק בבלוג) -->
        <a href="#home" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-700 hover:text-gray-900 transition-colors duration-200 bg-white rounded-full w-12 h-12 flex items-center justify-center shadow-md hidden" id="home-button-header" onclick="event.preventDefault(); navigateTo('home')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12m-4.5 9a2.25 2.25 0 01-2.25-2.25V15a3 3 0 00-3-3h-2.25a3 3 0 00-3 3v3.75m9-6v3.75m-3-3v3.75M9 21h6" />
            </svg>
        </a>
        <!-- כפתור צרו קשר -->
        <button class="absolute left-4 top-1/2 -translate-y-1/2 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-200" onclick="openContactModal()">
            צרו קשר
        </button>

        <!-- מיכל לכותרת וכותרת משנה - ממורכז בנפרד -->
        <div class="bg-gray-200 bg-opacity-70 rounded-xl shadow-lg mx-auto max-w-2xl p-4 flex flex-col items-center justify-center cursor-pointer" id="header-content-area">
            <h1 class="text-4xl md:text-5xl font-bold mb-2 text-gray-800" id="main-title"></h1>
            <p class="text-lg md:text-xl text-gray-600" id="main-subtitle"></p>
        </div>
    </header>

    <!-- תוכן דף הבית -->
    <div id="home-page" class="page-content flex-grow container mx-auto p-4 md:p-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="home-buttons-container">
            <!-- כפתורים ייטענו כאן על ידי JavaScript -->
        </div>
    </div>

    <!-- תוכן דף הבלוג -->
    <div id="blog-page" class="page-content flex-grow container mx-auto p-4 md:p-8">
        <div class="flex flex-col space-y-4 max-w-2xl mx-auto" id="blog-posts-container">
            <!-- כפתורי פוסטים בבלוג ייטענו כאן על ידי JavaScript -->
        </div>
    </div>

    <!-- מודאל פוסט בודד -->
    <div id="post-modal-overlay" class="fixed inset-0 modal-overlay flex items-center justify-center z-50 hidden">
        <div id="post-modal-content" class="bg-white p-6 rounded-xl shadow-lg max-w-4xl w-11/12 md:w-3/4 lg:w-2/3 xl:w-1/2 relative flex flex-col modal-content">
            <!-- כפתור סגירה -->
            <button class="absolute top-3 left-3 text-gray-500 hover:text-gray-800 text-3xl font-bold" onclick="closePostModal()">
                &times;
            </button>
            <!-- כותרת הפוסט בתוך המודאל -->
            <h2 class="text-3xl font-bold mb-2 text-gray-800 text-center" id="modal-post-title"></h2>
            <p class="text-md text-gray-600 text-center mb-4" id="modal-post-subtitle"></p>

            <!-- תוכן הפוסט -->
            <div class="prose lg:prose-xl text-gray-800 modal-body p-2" id="modal-post-body">
                <!-- תוכן הפוסט ייטען כאן על ידי JavaScript -->
            </div>

            <!-- כפתורי ניווט בתוך המודאל -->
            <div class="mt-6 flex justify-between items-center border-t pt-4">
                <button id="prev-post-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed" onclick="navigatePost(-1)">
                    פוסט קודם
                </button>
                <!-- מיכל לכפתור Ko-fi והטקסט המותאם אישית -->
                <div id="kofi-area-container" class="flex flex-col items-center space-y-2 hidden">
                    <p id="kofi-custom-text" class="text-sm text-gray-600 text-center"></p>
                    <a id="kofi-button-link" target="_blank" class="inline-block bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300">
                        <!-- טקסט כפתור Ko-fi ייטען ע"י JS -->
                    </a>
                </div>
                <button id="next-post-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed" onclick="navigatePost(1)">
                    פוסט הבא
                </button>
            </div>
        </div>
    </div>

    <!-- מודאל כניסה למנהל -->
    <div id="admin-login-modal-overlay" class="fixed inset-0 modal-overlay flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-xl shadow-lg w-96 text-center">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">הכנס סיסמת מנהל</h2>
            <input type="password" id="admin-password-input" class="w-full p-3 border border-gray-300 rounded-lg mb-4 text-center text-lg" placeholder="הכנס סיסמה">
            <button class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 w-full" onclick="checkAdminPassword()">
                התחבר
            </button>
            <p id="login-error-message" class="text-red-500 mt-2 hidden">סיסמה שגויה. נסה שוב.</p>
        </div>
    </div>

    <!-- מודאל פאנל ניהול -->
    <div id="admin-panel-modal-overlay" class="fixed inset-0 modal-overlay flex items-center justify-center z-50 hidden">
        <div id="admin-panel-content" class="bg-white p-6 rounded-xl shadow-lg max-w-5xl w-11/12 md:w-5/6 lg:w-4/5 xl:w-3/4 relative flex flex-col modal-content">
            <!-- כפתור סגירה -->
            <button class="absolute top-3 left-3 text-gray-500 hover:text-gray-800 text-3xl font-bold" onclick="closeAdminPanel()">
                &times;
            </button>
            <h2 class="text-3xl font-bold mb-4 text-gray-800 text-center">פאנל ניהול</h2>

            <div class="modal-body p-2 space-y-8">
                <!-- הגדרות כלליות -->
                <section class="border-b pb-4">
                    <h3 class="text-2xl font-semibold mb-4 text-gray-700">הגדרות כלליות</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="admin-main-title" class="block text-gray-700 text-sm font-bold mb-2">כותרת ראשית:</label>
                            <input type="text" id="admin-main-title" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" onkeyup="updateGeneralSettings()">
                        </div>
                        <div>
                            <label for="admin-subtitle" class="block text-gray-700 text-sm font-bold mb-2">כותרת משנה:</label>
                            <input type="text" id="admin-subtitle" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" onkeyup="updateGeneralSettings()">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2">תמונת רקע כללית:</label>
                            <input type="file" id="admin-global-bg-upload" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                            <div class="mt-2 flex items-center space-x-4">
                                <img id="admin-global-bg-preview" src="" alt="תצוגה מקדימה" class="w-24 h-24 object-cover rounded-lg border hidden">
                                <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300" onclick="removeGlobalBackground()">הסר תמונה</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- הגדרות כפתורי דף הבית -->
                <section class="border-b pb-4">
                    <h3 class="text-2xl font-semibold mb-4 text-gray-700">כפתורי דף הבית</h3>
                    <div id="admin-home-buttons-list" class="space-y-4">
                        <!-- כפתורים ייטענו כאן -->
                    </div>
                    <button class="mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300" onclick="addHomeButton()">הוסף כפתור חדש</button>
                </section>

                <!-- הגדרות בלוג -->
                <section class="border-b pb-4">
                    <h3 class="text-2xl font-semibold mb-4 text-gray-700">הגדרות בלוג</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="admin-blog-title" class="block text-gray-700 text-sm font-bold mb-2">כותרת בלוג:</label>
                            <input type="text" id="admin-blog-title" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" onkeyup="updateBlogSettings()">
                        </div>
                        <div>
                            <label for="admin-blog-subtitle" class="block text-gray-700 text-sm font-bold mb-2">כותרת משנה בלוג:</label>
                            <input type="text" id="admin-blog-subtitle" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" onkeyup="updateBlogSettings()">
                        </div>
                    </div>
                    <h4 class="text-xl font-semibold mt-6 mb-3 text-gray-700">פוסטים בבלוג:</h4>
                    <div id="admin-blog-posts-list" class="space-y-4">
                        <!-- פוסטים בבלוג ייטענו כאן -->
                    </div>
                    <button class="mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300" onclick="addBlogPost()">הוסף פוסט לבלוג</button>
                </section>

                <!-- עריכת פוסטים (כללי) -->
                <section class="border-b pb-4">
                    <h3 class="text-2xl font-semibold mb-4 text-gray-700">עריכת פוסטים</h3>
                    <div id="admin-posts-list" class="space-y-4">
                        <!-- פוסטים לעריכה ייטענו כאן -->
                    </div>
                </section>

                <!-- הגדרות Ko-fi -->
                <section class="border-b pb-4">
                    <h3 class="text-2xl font-semibold mb-4 text-gray-700">הגדרות Ko-fi</h3>
                    <div class="flex items-center mb-4">
                        <input type="checkbox" id="admin-kofi-enabled" class="mr-2" onchange="updateKofiSettings()">
                        <label for="admin-kofi-enabled" class="text-gray-700">הצג כפתור Ko-fi בפוסטים</label>
                    </div>
                    <div class="mt-4">
                        <label for="admin-kofi-custom-text" class="block text-gray-700 text-sm font-bold mb-2">טקסט תמיכה (מעל הכפתור):</label>
                        <textarea id="admin-kofi-custom-text" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline h-20" onkeyup="updateKofiSettings()"></textarea>
                    </div>
                    <div class="mt-4">
                        <label for="admin-kofi-text" class="block text-gray-700 text-sm font-bold mb-2">טקסט כפתור Ko-fi:</label>
                        <input type="text" id="admin-kofi-text" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" onkeyup="updateKofiSettings()">
                    </div>
                    <div class="mt-4">
                        <label for="admin-kofi-link" class="block text-gray-700 text-sm font-bold mb-2">קישור Ko-fi:</label>
                        <input type="url" id="admin-kofi-link" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" onkeyup="updateKofiSettings()">
                    </div>
                </section>

                <!-- שינוי סיסמה -->
                <section class="border-b pb-4">
                    <h3 class="text-2xl font-semibold mb-4 text-gray-700">שינוי סיסמה</h3>
                    <div>
                        <label for="admin-new-password" class="block text-gray-700 text-sm font-bold mb-2">סיסמה חדשה:</label>
                        <input type="password" id="admin-new-password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <div class="mt-4">
                        <label for="admin-confirm-password" class="block text-gray-700 text-sm font-bold mb-2">אשר סיסמה חדשה:</label>
                        <input type="password" id="admin-confirm-password" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                    </div>
                    <button class="mt-4 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300" onclick="changeAdminPassword()">שנה סיסמה</button>
                    <p id="password-change-message" class="mt-2 text-sm"></p>
                </section>

                <!-- כפתור שמירה והורדה -->
                <div class="mt-8 text-center">
                    <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-xl transition-colors duration-300" onclick="saveAndDownloadSite()">שמור והורד אתר</button>
                </div>
            </div>
        </div>
    </div>

    <!-- מודאל צור קשר -->
    <div id="contact-modal-overlay" class="fixed inset-0 modal-overlay flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-xl shadow-lg w-11/12 max-w-md text-center relative">
            <button class="absolute top-3 left-3 text-gray-500 hover:text-gray-800 text-3xl font-bold" onclick="closeContactModal()">
                &times;
            </button>
            <h2 class="text-2xl font-bold mb-4 text-gray-800">צרו קשר</h2>
            <form action="https://formsubmit.co/elizaidoff@gmail.com" method="POST">
                <input type="hidden" name="_subject" value="New Contact Form Submission from Your Website">
                <input type="hidden" name="_captcha" value="false">

                <div class="mb-4">
                    <label for="contact-name" class="block text-gray-700 text-right text-sm font-bold mb-2">שם:</label>
                    <input type="text" id="contact-name" name="name" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                <div class="mb-4">
                    <label for="contact-email" class="block text-gray-700 text-right text-sm font-bold mb-2">אימייל:</label>
                    <input type="email" id="contact-email" name="email" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required>
                </div>
                <div class="mb-6">
                    <label for="contact-message" class="block text-gray-700 text-right text-sm font-bold mb-2">הודעה:</label>
                    <textarea id="contact-message" name="message" rows="5" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" required></textarea>
                </div>
                <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 w-full">
                    שלח הודעה
                </button>
            </form>
        </div>
    </div>

    <script>
        // אובייקט נתונים מרכזי של האתר
        let websiteData = {
            adminPassword: '1234',
            globalBackground: '', // Base64 image data or empty string
            header: {
                mainTitle: 'ברוכים הבאים לאתר שלי',
                subTitle: 'כאן תמצאו את כל מה שאתם צריכים'
            },
            homePageButtons: [
                { id: 'homeBtn1', text: 'כפתור לדוגמה 1 (פוסט)', type: 'post', targetId: 'post1', image: 'https://placehold.co/60x60/87CEEB/FFFFFF?text=1' },
                { id: 'homeBtn2', text: 'כפתור לדוגמה 2 (חיצוני)', type: 'external', targetUrl: 'https://www.google.com', image: 'https://placehold.co/60x60/FFD700/FFFFFF?text=2' },
                { id: 'homeBtn3', text: 'כפתור לדוגמה 3 (בלוג)', type: 'blog', targetId: 'blog', image: 'https://placehold.co/60x60/90EE90/FFFFFF?text=3' },
            ],
            blogPage: {
                title: 'הבלוג שלנו',
                subtitle: 'קראו את הפוסטים האחרונים שלנו',
                posts: [ // These are references to postData keys
                    { id: 'blogPost1', text: 'פוסט חדש: טיפים לעיצוב אתרים', targetId: 'post1', image: 'https://placehold.co/60x60/ADD8E6/FFFFFF?text=P1' },
                    { id: 'blogPost2', text: 'מדריך: בניית אתר מהיר', targetId: 'post2', image: 'https://placehold.co/60x60/FFB6C1/FFFFFF?text=P2' },
                    { id: 'blogPost3', text: 'חידושים בעולם ה-AI', targetId: 'post3', image: 'https://placehold.co/60x60/DDA0DD/FFFFFF?text=P3' },
                ]
            },
            posts: { // Actual post content
                'post1': {
                    title: 'טיפים לעיצוב אתרים מודרני',
                    subtitle: 'פורסם ב-1 באוגוסט 2025',
                    content: `<p>בעידן הדיגיטלי של היום, עיצוב אתרים הוא קריטי לחווית המשתמש. הנה כמה טיפים שיעזרו לכם ליצור אתר מודרני ומרשים:</p><ul><li><strong>פשטות ומינימליזם:</strong> פחות זה יותר. עיצוב נקי עוזר למשתמש להתמקד בתוכן החשוב.</li><li><strong>רספונסיביות:</strong> ודאו שהאתר נראה ומתפקד היטב בכל המכשירים – מחשבים, טאבלטים וסמארטפונים.</li><li><strong>טיפוגרפיה:</strong> בחרו פונטים קריאים ונעימים לעין. השתמשו בגדלים ומשקלים שונים להדגשה.</li><li><strong>צבעים:</strong> השתמשו בפלטת צבעים מוגבלת ונעימה. צבעים משפיעים על מצב הרוח ועל תפיסת המותג.</li><li><strong>מהירות טעינה:</strong> אתר מהיר משפר את חווית המשתמש ואת דירוג ה-SEO.</li></ul><p>יישום הטיפים הללו יעזור לכם לבנות אתר שלא רק נראה טוב, אלא גם מתפקד מצוין ומספק חוויה חיובית למבקרים.</p>`,
                    image: 'https://placehold.co/600x300/F0F8FF/333333?text=עיצוב+אתרים'
                },
                'post2': {
                    title: 'מדריך מקיף: בניית אתר אינטרנט מהיר ויעיל',
                    subtitle: 'פורסם ב-15 ביולי 2025',
                    content: `<p>מהירות טעינה היא אחד הגורמים החשובים ביותר להצלחת אתר אינטרנט. מדריך זה יספק לכם כלים ושיטות לבניית אתר מהיר:</p><ol><li><strong>אופטימיזציה של תמונות:</strong> כווצו תמונות לפני העלאה והשתמשו בפורמטים מודרניים (כמו WebP).</li><li><strong>שימוש ב-CDN:</strong> רשת להפצת תוכן (CDN) מקרבת את התוכן למשתמשים ומאיצה את הטעינה.</li><li><strong>צמצום קוד (Minification):</strong> הסירו רווחים מיותרים ותווים לא נחוצים מקבצי CSS ו-JavaScript.</li><li><strong>Caching:</strong> השתמשו במנגנוני מטמון כדי לשמור עותקים של דפים וקבצים סטטיים.</li><li><strong>בחירת אירוח איכותי:</strong> ספק אירוח אמין ומהיר הוא בסיס לאתר מהיר.</li></ol><p>יישום אסטרטגיות אלו יבטיח שהאתר שלכם יטען במהירות, ישפר את חווית המשתמש ויסייע בקידום במנועי חיפוש.</p>`,
                    image: 'https://placehold.co/600x300/FFFACD/333333?text=אתר+מהיר'
                },
                'post3': {
                    title: 'החידושים האחרונים בעולם הבינה המלאכותית (AI)',
                    subtitle: 'פורסם ב-22 ביוני 2025',
                    content: `<p>עולם הבינה המלאכותית מתפתח בקצב מסחרר, עם חידושים כמעט יומיומיים. הנה כמה מההתפתחויות הבולטות ביותר לאחרונה:</p><ul><li><strong>מודלי שפה גדולים (LLMs):</strong> שיפורים משמעותיים ביכולתם להבין, לייצר ולתרגם טקסט באופן טבעי.</li><li><strong>בינה מלאכותית יוצרת (Generative AI):</strong> יצירת תמונות, וידאו, מוזיקה ותוכן כתוב באיכות גבוהה על בסיס הנחיות טקסטואליות.</li><li><strong>AI ברפואה:</strong> שימוש ב-AI לאבחון מחלות, פיתוח תרופות וטיפולים מותאמים אישית.</li><li><strong>רובוטיקה מתקדמת:</strong> רובוטים חכמים יותר המסוגלים לבצע משימות מורכבות בסביבות לא מובנות.</li></ul><p>החידושים הללו משנים את הדרך בה אנו עובדים, לומדים ומתקשרים, וצפויים להמשיך ולהשפיע על כל תחומי החיים.</p>`,
                    image: 'https://placehold.co/600x300/E6E6FA/333333?text=AI+חידושים'
                }
            },
            kofi: {
                enabled: false,
                buttonText: 'תמכו בנו ב-Ko-fi',
                link: 'https://ko-fi.com/yourprofile',
                customText: 'אם אהבתם את התוכן, אתם מוזמנים לתמוך בי ב-Ko-fi!' // טקסט ברירת מחדל
            }
        };

        // סדר הפוסטים לניווט קודם/הבא
        let postOrder = Object.keys(websiteData.posts);
        let currentPostId = null; // מזהה הפוסט הפתוח כרגע במודאל
        let currentPageId = 'home'; // מזהה הדף הראשי הפעיל (home או blog)
        let clickCount = 0; // מונה לחיצות לכניסה לפאנל ניהול
        let clickTimeout; // טיימר לאיפוס מונה הלחיצות

        // --- פונקציות עזר כלליות ---

        // פונקציה ליצירת ID ייחודי
        function generateUniqueId(prefix = 'id') {
            return prefix + '_' + Math.random().toString(36).substr(2, 9);
        }

        // פונקציה לטעינת תמונה כ-Base64
        function loadImageAsBase64(file, callback) {
            if (!file) {
                callback('');
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                callback(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        // --- פונקציות ניווט ותצוגה (צד לקוח) ---

        // פונקציה לניווט בין דפים ראשיים
        function navigateTo(pageId) {
            const pages = document.querySelectorAll('.page-content');
            pages.forEach(page => page.classList.remove('active')); // הסתר את כל הדפים

            let headerTitle = '';
            let headerSubtitle = '';
            const homeButtonHeader = document.getElementById('home-button-header');

            if (pageId === 'home') {
                document.getElementById('home-page').classList.add('active');
                headerTitle = websiteData.header.mainTitle;
                headerSubtitle = websiteData.header.subTitle;
                currentPageId = 'home';
                homeButtonHeader.classList.add('hidden'); // הסתר את כפתור הבית בדף הבית
            } else if (pageId === 'blog') {
                document.getElementById('blog-page').classList.add('active');
                headerTitle = websiteData.blogPage.title;
                headerSubtitle = websiteData.blogPage.subtitle;
                currentPageId = 'blog';
                homeButtonHeader.classList.remove('hidden'); // הצג את כפתור הבית בדף הבלוג
            }

            // עדכן את הכותרות הראשיות ב-header
            document.getElementById('main-title').textContent = headerTitle;
            document.getElementById('main-subtitle').textContent = headerSubtitle;

            // עדכן את ה-URL באמצעות Hash
            window.location.hash = pageId;
            closePostModal(); // וודא שהמודאל סגור כשמנווטים לדף ראשי
            closeContactModal(); // וודא שמודאל צור קשר סגור
        }

        // פונקציה לפתיחת מודאל פוסט
        function openPostModal(postId) {
            const post = websiteData.posts[postId];
            if (!post) {
                console.error('Post not found:', postId);
                return;
            }

            currentPostId = postId; // שמור את הפוסט הנוכחי
            document.getElementById('modal-post-title').textContent = post.title;
            document.getElementById('modal-post-subtitle').textContent = post.subtitle;

            // טען תוכן הפוסט, כולל תמונה
            let postContentHtml = post.content;
            if (post.image) {
                postContentHtml = `<img src="${post.image}" alt="${post.title}" class="post-image rounded-lg my-4">` + postContentHtml;
            }
            document.getElementById('modal-post-body').innerHTML = postContentHtml;

            // עדכן כפתורי ניווט קודם/הבא
            updatePostNavigationButtons();

            // הצג כפתור Ko-fi וטקסט מותאם אישית אם מופעל
            const kofiAreaContainer = document.getElementById('kofi-area-container');
            const kofiCustomText = document.getElementById('kofi-custom-text');
            const kofiLink = document.getElementById('kofi-button-link');

            if (websiteData.kofi.enabled) {
                kofiLink.href = websiteData.kofi.link;
                kofiLink.textContent = websiteData.kofi.buttonText;
                kofiCustomText.textContent = websiteData.kofi.customText;
                kofiAreaContainer.classList.remove('hidden');
            } else {
                kofiAreaContainer.classList.add('hidden');
            }


            document.getElementById('post-modal-overlay').classList.remove('hidden'); // הצג את המודאל
            window.location.hash = `post-modal-${postId}`; // עדכן את ה-Hash
        }

        // פונקציה לסגירת מודאל פוסט
        function closePostModal() {
            document.getElementById('post-modal-overlay').classList.add('hidden'); // הסתר את המודאל
            currentPostId = null; // אפס את הפוסט הנוכחי
            // חזור ל-hash של הדף הראשי הקודם
            window.location.hash = currentPageId;
        }

        // פונקציה לעדכון כפתורי ניווט בתוך המודאל
        function updatePostNavigationButtons() {
            postOrder = Object.keys(websiteData.posts); // וודא שסדר הפוסטים מעודכן
            const currentIndex = postOrder.indexOf(currentPostId);
            const prevBtn = document.getElementById('prev-post-btn');
            const nextBtn = document.getElementById('next-post-btn');

            prevBtn.disabled = currentIndex <= 0;
            nextBtn.disabled = currentIndex >= postOrder.length - 1;
        }

        // פונקציה לניווט בין פוסטים (קודם/הבא)
        function navigatePost(direction) { // direction: -1 for prev, 1 for next
            const currentIndex = postOrder.indexOf(currentPostId);
            const newIndex = currentIndex + direction;

            if (newIndex >= 0 && newIndex < postOrder.length) {
                openPostModal(postOrder[newIndex]);
            }
        }

        // פונקציה לרינדור כפתורי דף הבית
        function renderHomePageButtons() {
            const container = document.getElementById('home-buttons-container');
            container.innerHTML = ''; // נקה כפתורים קיימים

            // יצירת שני מיכלים (עמודות)
            const col1 = document.createElement('div');
            col1.className = 'flex flex-col space-y-4';
            const col2 = document.createElement('div');
            col2.className = 'flex flex-col space-y-4';

            websiteData.homePageButtons.forEach((button, index) => {
                const buttonElement = document.createElement('a');
                buttonElement.className = 'button-link';
                buttonElement.innerHTML = `
                    <span class="text-xl font-semibold text-gray-800">${button.text}</span>
                    <img src="${button.image}" alt="${button.text}" class="w-14 h-14 rounded-full object-cover border-2 border-blue-400">
                `;

                if (button.type === 'post') {
                    buttonElement.href = `#post-modal-${button.targetId}`;
                    buttonElement.onclick = (e) => { e.preventDefault(); openPostModal(button.targetId); };
                } else if (button.type === 'external') {
                    buttonElement.href = button.targetUrl;
                    buttonElement.target = '_blank';
                } else if (button.type === 'blog') {
                    buttonElement.href = `#blog`;
                    buttonElement.onclick = (e) => { e.preventDefault(); navigateTo('blog'); };
                }

                if (index % 2 === 0) { // חלוקה לשתי עמודות
                    col1.appendChild(buttonElement);
                } else {
                    col2.appendChild(buttonElement);
                }
            });
            container.appendChild(col1);
            container.appendChild(col2);
        }

        // פונקציה לרינדור פוסטים בבלוג
        function renderBlogPosts() {
            const container = document.getElementById('blog-posts-container');
            container.innerHTML = ''; // נקה פוסטים קיימים

            websiteData.blogPage.posts.forEach(postRef => {
                const post = websiteData.posts[postRef.targetId];
                if (!post) return; // אם הפוסט לא קיים, דלג

                const postElement = document.createElement('a');
                postElement.className = 'button-link';
                postElement.href = `#post-modal-${postRef.targetId}`;
                postElement.onclick = (e) => { e.preventDefault(); openPostModal(postRef.targetId); };
                postElement.innerHTML = `
                    <span class="text-xl font-semibold text-gray-800">${postRef.text}</span>
                    <img src="${postRef.image}" alt="${postRef.text}" class="w-14 h-14 rounded-full object-cover border-2 border-blue-300">
                `;
                container.appendChild(postElement);
            });
        }

        // פונקציה לטעינה ראשונית של האתר
        function loadWebsite() {
            // עדכן רקע גלובלי
            document.body.style.backgroundImage = websiteData.globalBackground ? `url('${websiteData.globalBackground}')` : 'none';

            renderHomePageButtons();
            renderBlogPosts();
            handleHashChange(); // טען את הדף הנכון לפי ה-Hash ב-URL
        }

        // --- פונקציות פאנל ניהול ---

        // פונקציה לפתיחת מודאל כניסה למנהל
        let headerClickTimer = null;
        let headerClickCount = 0;

        document.getElementById('header-content-area').addEventListener('click', () => {
            headerClickCount++;
            if (headerClickTimer) clearTimeout(headerClickTimer);
            headerClickTimer = setTimeout(() => {
                headerClickCount = 0;
            }, 500); // איפוס מונה לחיצות לאחר 500ms

            if (headerClickCount === 3) {
                document.getElementById('admin-login-modal-overlay').classList.remove('hidden');
                document.getElementById('admin-password-input').value = '';
                document.getElementById('login-error-message').classList.add('hidden');
                headerClickCount = 0; // איפוס מיידי לאחר פתיחה
            }
        });

        function checkAdminPassword() {
            const inputPassword = document.getElementById('admin-password-input').value;
            if (inputPassword === websiteData.adminPassword) {
                document.getElementById('admin-login-modal-overlay').classList.add('hidden');
                openAdminPanel();
            } else {
                document.getElementById('login-error-message').classList.remove('hidden');
            }
        }

        function openAdminPanel() {
            document.getElementById('admin-panel-modal-overlay').classList.remove('hidden');
            // טען נתונים קיימים לפאנל
            document.getElementById('admin-main-title').value = websiteData.header.mainTitle;
            document.getElementById('admin-subtitle').value = websiteData.header.subTitle;
            if (websiteData.globalBackground) {
                document.getElementById('admin-global-bg-preview').src = websiteData.globalBackground;
                document.getElementById('admin-global-bg-preview').classList.remove('hidden');
            } else {
                document.getElementById('admin-global-bg-preview').classList.add('hidden');
            }

            document.getElementById('admin-blog-title').value = websiteData.blogPage.title;
            document.getElementById('admin-blog-subtitle').value = websiteData.blogPage.subtitle;

            document.getElementById('admin-kofi-enabled').checked = websiteData.kofi.enabled;
            document.getElementById('admin-kofi-custom-text').value = websiteData.kofi.customText; // טען את הטקסט המותאם אישית
            document.getElementById('admin-kofi-text').value = websiteData.kofi.buttonText;
            document.getElementById('admin-kofi-link').value = websiteData.kofi.link;

            renderAdminHomeButtons();
            renderAdminBlogPosts();
            renderAdminPostsForEdit();
        }

        function closeAdminPanel() {
            document.getElementById('admin-panel-modal-overlay').classList.add('hidden');
            loadWebsite(); // רענן את האתר הציבורי לאחר סגירת פאנל
        }

        // --- עדכון הגדרות כלליות ---
        function updateGeneralSettings() {
            websiteData.header.mainTitle = document.getElementById('admin-main-title').value;
            websiteData.header.subTitle = document.getElementById('admin-subtitle').value;
            // עדכן את התצוגה הציבורית באופן מיידי
            document.getElementById('main-title').textContent = websiteData.header.mainTitle;
            document.getElementById('main-subtitle').textContent = websiteData.header.subTitle;
        }

        document.getElementById('admin-global-bg-upload').addEventListener('change', function(event) {
            loadImageAsBase64(event.target.files[0], (base64) => {
                websiteData.globalBackground = base64;
                document.getElementById('admin-global-bg-preview').src = base64;
                document.getElementById('admin-global-bg-preview').classList.remove('hidden');
                document.body.style.backgroundImage = `url('${base64}')`;
            });
        });

        function removeGlobalBackground() {
            websiteData.globalBackground = '';
            document.getElementById('admin-global-bg-preview').classList.add('hidden');
            document.body.style.backgroundImage = 'none';
            document.getElementById('admin-global-bg-upload').value = ''; // נקה את בחירת הקובץ
        }

        // --- ניהול כפתורי דף הבית ---
        function renderAdminHomeButtons() {
            const container = document.getElementById('admin-home-buttons-list');
            container.innerHTML = '';
            websiteData.homePageButtons.forEach((button, index) => {
                const buttonDiv = document.createElement('div');
                buttonDiv.className = 'flex items-center space-x-4 p-3 border rounded-lg bg-gray-50 relative';
                buttonDiv.draggable = true;
                buttonDiv.dataset.index = index; // לשימוש ב-drag and drop

                buttonDiv.innerHTML = `
                    <div class="flex-grow grid grid-cols-1 md:grid-cols-3 gap-2 items-center">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-1">טקסט:</label>
                            <input type="text" value="${button.text}" class="shadow appearance-none border rounded w-full py-1 px-2 text-gray-700 leading-tight" onkeyup="updateHomeButton(${index}, 'text', this.value)">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-1">סוג:</label>
                            <select class="shadow appearance-none border rounded w-full py-1 px-2 text-gray-700 leading-tight" onchange="updateHomeButton(${index}, 'type', this.value)">
                                <option value="post" ${button.type === 'post' ? 'selected' : ''}>פוסט</option>
                                <option value="external" ${button.type === 'external' ? 'selected' : ''}>קישור חיצוני</option>
                                <option value="blog" ${button.type === 'blog' ? 'selected' : ''}>דף בלוג</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-1">יעד:</label>
                            <input type="text" value="${button.type === 'external' ? button.targetUrl : button.targetId || ''}" class="shadow appearance-none border rounded w-full py-1 px-2 text-gray-700 leading-tight" onkeyup="updateHomeButtonTarget(${index}, this.value)">
                        </div>
                        <div class="md:col-span-3">
                            <label class="block text-gray-700 text-sm font-bold mb-1">תמונה:</label>
                            <input type="file" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" onchange="updateHomeButtonImage(${index}, this.files[0])">
                            <div class="mt-1 flex items-center space-x-2">
                                <img src="${button.image}" alt="תצוגה מקדימה" class="w-10 h-10 rounded-full object-cover border ${button.image ? '' : 'hidden'}">
                                <button class="text-red-500 hover:text-red-700 text-sm" onclick="removeHomeButtonImage(${index})">הסר</button>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col space-y-1 ml-2">
                        <button class="text-red-500 hover:text-red-700" onclick="removeHomeButton(${index})">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.927a2.25 2.25 0 01-2.244-2.077L4.74 5.61a1.125 1.125 0 011.12-1.22l10.047-.842a.75.75 0 01.75.75V4.5a2.25 2.25 0 00-2.25-2.25H12.75M15 9V5.25A2.25 2.25 0 0012.75 3h-1.5A2.25 2.25 0 009 5.25V9m-3.75 0h7.5" /></svg>
                        </button>
                        <button class="text-gray-500 hover:text-gray-700" onclick="moveHomeButton(${index}, -1)">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" /></svg>
                        </button>
                        <button class="text-gray-500 hover:text-gray-700" onclick="moveHomeButton(${index}, 1)">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" /></svg>
                        </button>
                    </div>
                `;
                container.appendChild(buttonDiv);
            });
            addDragDropListeners(container, websiteData.homePageButtons, renderAdminHomeButtons);
            renderHomePageButtons(); // רענן את התצוגה הציבורית
        }

        function addHomeButton() {
            websiteData.homePageButtons.push({
                id: generateUniqueId('homeBtn'),
                text: 'כפתור חדש',
                type: 'post',
                targetId: generateUniqueId('post'), // יצירת ID פוסט חדש אוטומטית
                image: 'https://placehold.co/60x60/CCCCCC/FFFFFF?text=חדש'
            });
            // אם הכפתור הוא מסוג פוסט, צור פוסט חדש
            const newPostId = websiteData.homePageButtons[websiteData.homePageButtons.length - 1].targetId;
            websiteData.posts[newPostId] = {
                title: 'פוסט חדש',
                subtitle: 'תאריך: ' + new Date().toLocaleDateString('he-IL'),
                content: '<p>תוכן הפוסט החדש כאן.</p>',
                image: ''
            };
            renderAdminHomeButtons();
            renderAdminPostsForEdit(); // רענן רשימת פוסטים לעריכה
        }

        function removeHomeButton(index) {
            const button = websiteData.homePageButtons[index];
            if (button.type === 'post' && websiteData.posts[button.targetId]) {
                // שקול אם למחוק את הפוסט עצמו או רק את הקישור אליו
                // כרגע: מוחק רק את הקישור. אם תרצה למחוק את הפוסט בפועל, הוסף:
                // delete websiteData.posts[button.targetId];
                // renderAdminPostsForEdit();
            }
            websiteData.homePageButtons.splice(index, 1);
            renderAdminHomeButtons();
        }

        function updateHomeButton(index, field, value) {
            websiteData.homePageButtons[index][field] = value;
            renderHomePageButtons(); // רענן את התצוגה הציבורית
        }

        function updateHomeButtonTarget(index, value) {
            const button = websiteData.homePageButtons[index];
            if (button.type === 'external') {
                button.targetUrl = value;
            } else {
                button.targetId = value;
            }
            renderHomePageButtons(); // רענן את התצוגה הציבורית
        }

        function updateHomeButtonImage(index, file) {
            loadImageAsBase64(file, (base64) => {
                websiteData.homePageButtons[index].image = base64;
                renderAdminHomeButtons(); // רענן את התצוגה של פאנל הניהול
            });
        }

        function removeHomeButtonImage(index) {
            websiteData.homePageButtons[index].image = '';
            renderAdminHomeButtons();
        }

        function moveHomeButton(index, direction) {
            const newIndex = index + direction;
            if (newIndex >= 0 && newIndex < websiteData.homePageButtons.length) {
                const [movedItem] = websiteData.homePageButtons.splice(index, 1);
                websiteData.homePageButtons.splice(newIndex, 0, movedItem);
                renderAdminHomeButtons();
            }
        }

        // --- ניהול פוסטים בבלוג ---
        function updateBlogSettings() {
            websiteData.blogPage.title = document.getElementById('admin-blog-title').value;
            websiteData.blogPage.subtitle = document.getElementById('admin-blog-subtitle').value;
            // עדכן את התצוגה הציבורית באופן מיידי
            if (currentPageId === 'blog') {
                document.getElementById('main-title').textContent = websiteData.blogPage.title;
                document.getElementById('main-subtitle').textContent = websiteData.blogPage.subtitle;
            }
        }

        function renderAdminBlogPosts() {
            const container = document.getElementById('admin-blog-posts-list');
            container.innerHTML = '';
            websiteData.blogPage.posts.forEach((postRef, index) => {
                const postDiv = document.createElement('div');
                postDiv.className = 'flex items-center space-x-4 p-3 border rounded-lg bg-gray-50 relative';
                postDiv.draggable = true;
                postDiv.dataset.index = index;

                // יצירת רשימה של פוסטים קיימים לבחירה
                const postOptions = Object.keys(websiteData.posts).map(postId => `
                    <option value="${postId}" ${postRef.targetId === postId ? 'selected' : ''}>
                        ${websiteData.posts[postId].title} (${postId})
                    </option>
                `).join('');

                postDiv.innerHTML = `
                    <div class="flex-grow grid grid-cols-1 md:grid-cols-3 gap-2 items-center">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-1">טקסט כפתור:</label>
                            <input type="text" value="${postRef.text}" class="shadow appearance-none border rounded w-full py-1 px-2 text-gray-700 leading-tight" onkeyup="updateBlogPostRef(${index}, 'text', this.value)">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-1">בחר פוסט:</label>
                            <select class="shadow appearance-none border rounded w-full py-1 px-2 text-gray-700 leading-tight" onchange="updateBlogPostRef(${index}, 'targetId', this.value)">
                                ${postOptions}
                            </select>
                        </div>
                        <div class="md:col-span-3">
                            <label class="block text-gray-700 text-sm font-bold mb-1">תמונה:</label>
                            <input type="file" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" onchange="updateBlogPostRefImage(${index}, this.files[0])">
                            <div class="mt-1 flex items-center space-x-2">
                                <img src="${postRef.image}" alt="תצוגה מקדימה" class="w-10 h-10 rounded-full object-cover border ${postRef.image ? '' : 'hidden'}">
                                <button class="text-red-500 hover:text-red-700 text-sm" onclick="removeBlogPostRefImage(${index})">הסר</button>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col space-y-1 ml-2">
                        <button class="text-red-500 hover:text-red-700" onclick="removeBlogPost(${index})">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.927a2.25 2.25 0 01-2.244-2.077L4.74 5.61a1.125 1.125 0 011.12-1.22l10.047-.842a.75.75 0 01.75.75V4.5a2.25 2.25 0 00-2.25-2.25H12.75M15 9V5.25A2.25 2.25 0 0012.75 3h-1.5A2.25 2.25 0 009 5.25V9m-3.75 0h7.5" /></svg>
                        </button>
                        <button class="text-gray-500 hover:text-gray-700" onclick="moveBlogPost(${index}, -1)">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" /></svg>
                        </button>
                        <button class="text-gray-500 hover:text-gray-700" onclick="moveBlogPost(${index}, 1)">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" /></svg>
                        </button>
                    </div>
                `;
                container.appendChild(postDiv);
            });
            addDragDropListeners(container, websiteData.blogPage.posts, renderAdminBlogPosts);
            renderBlogPosts(); // רענן את התצוגה הציבורית
        }

        function addBlogPost() {
            const newPostId = generateUniqueId('post');
            websiteData.posts[newPostId] = {
                title: 'פוסט חדש (בלוג)',
                subtitle: 'תאריך: ' + new Date().toLocaleDateString('he-IL'),
                content: '<p>תוכן הפוסט החדש בבלוג כאן.</p>',
                image: ''
            };
            websiteData.blogPage.posts.push({
                id: generateUniqueId('blogRef'),
                text: 'כותרת פוסט חדש',
                targetId: newPostId,
                image: 'https://placehold.co/60x60/CCCCCC/FFFFFF?text=חדש'
            });
            renderAdminBlogPosts();
            renderAdminPostsForEdit(); // רענן רשימת פוסטים לעריכה
        }

        function removeBlogPost(index) {
            websiteData.blogPage.posts.splice(index, 1);
            renderAdminBlogPosts();
        }

        function updateBlogPostRef(index, field, value) {
            websiteData.blogPage.posts[index][field] = value;
            renderBlogPosts();
        }

        function updateBlogPostRefImage(index, file) {
            loadImageAsBase64(file, (base64) => {
                websiteData.blogPage.posts[index].image = base64;
                renderAdminBlogPosts();
            });
        }

        function removeBlogPostRefImage(index) {
            websiteData.blogPage.posts[index].image = '';
            renderAdminBlogPosts();
        }

        function moveBlogPost(index, direction) {
            const newIndex = index + direction;
            if (newIndex >= 0 && newIndex < websiteData.blogPage.posts.length) {
                const [movedItem] = websiteData.blogPage.posts.splice(index, 1);
                websiteData.blogPage.posts.splice(newIndex, 0, movedItem);
                renderAdminBlogPosts();
            }
        }

        // --- ניהול עריכת פוסטים (כללי) ---
        function renderAdminPostsForEdit() {
            const container = document.getElementById('admin-posts-list');
            container.innerHTML = '';
            for (const postId in websiteData.posts) {
                const post = websiteData.posts[postId];
                const postDiv = document.createElement('div');
                postDiv.className = 'p-3 border rounded-lg bg-gray-50 space-y-2';
                postDiv.innerHTML = `
                    <h4 class="text-lg font-semibold text-gray-800">${post.title} (ID: ${postId})</h4>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-1">כותרת פוסט:</label>
                        <input type="text" value="${post.title}" class="shadow appearance-none border rounded w-full py-1 px-2 text-gray-700 leading-tight" onkeyup="updatePostContent('${postId}', 'title', this.value)">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-1">כותרת משנה:</label>
                        <input type="text" value="${post.subtitle}" class="shadow appearance-none border rounded w-full py-1 px-2 text-gray-700 leading-tight" onkeyup="updatePostContent('${postId}', 'subtitle', this.value)">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-1">תוכן (HTML):</label>
                        <textarea class="shadow appearance-none border rounded w-full py-1 px-2 text-gray-700 leading-tight h-32" onkeyup="updatePostContent('${postId}', 'content', this.value)">${post.content}</textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-1">תמונת פוסט:</label>
                        <input type="file" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-2 file:py-1 file:px-2 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" onchange="updatePostImage('${postId}', this.files[0])">
                        <div class="mt-1 flex items-center space-x-2">
                            <img src="${post.image}" alt="תצוגה מקדימה" class="w-20 h-auto object-contain border ${post.image ? '' : 'hidden'}">
                            <button class="text-red-500 hover:text-red-700 text-sm" onclick="removePostImage('${postId}')">הסר</button>
                        </div>
                    </div>
                    <button class="bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded-lg text-sm mt-2" onclick="deletePost('${postId}')">מחק פוסט</button>
                `;
                container.appendChild(postDiv);
            }
        }

        function updatePostContent(postId, field, value) {
            websiteData.posts[postId][field] = value;
        }

        function updatePostImage(postId, file) {
            loadImageAsBase64(file, (base64) => {
                websiteData.posts[postId].image = base64;
                renderAdminPostsForEdit(); // רענן את התצוגה של פאנל הניהול
            });
        }

        function removePostImage(postId) {
            websiteData.posts[postId].image = '';
            renderAdminPostsForEdit();
        }

        function deletePost(postIdToDelete) {
            // וודא שאין כפתורים המפנים לפוסט זה לפני המחיקה
            const isReferencedInHome = websiteData.homePageButtons.some(btn => btn.type === 'post' && btn.targetId === postIdToDelete);
            const isReferencedInBlog = websiteData.blogPage.posts.some(postRef => postRef.targetId === postIdToDelete);

            if (isReferencedInHome || isReferencedInBlog) {
                alert('לא ניתן למחוק פוסט המקושר לכפתור קיים בדף הבית או בבלוג. אנא הסר את הקישורים קודם.');
                return;
            }

            if (confirm(`האם אתה בטוח שברצונך למחוק את הפוסט "${websiteData.posts[postIdToDelete].title}"?`)) {
                delete websiteData.posts[postIdToDelete];
                renderAdminPostsForEdit();
                // רענן את סדר הפוסטים
                postOrder = Object.keys(websiteData.posts);
            }
        }

        // --- ניהול הגדרות Ko-fi ---
        function updateKofiSettings() {
            websiteData.kofi.enabled = document.getElementById('admin-kofi-enabled').checked;
            websiteData.kofi.customText = document.getElementById('admin-kofi-custom-text').value; // עדכן את הטקסט המותאם אישית
            websiteData.kofi.buttonText = document.getElementById('admin-kofi-text').value;
            websiteData.kofi.link = document.getElementById('admin-kofi-link').value;
        }

        // --- שינוי סיסמה ---
        function changeAdminPassword() {
            const newPass = document.getElementById('admin-new-password').value;
            const confirmPass = document.getElementById('admin-confirm-password').value;
            const messageElement = document.getElementById('password-change-message');

            if (newPass === '' || confirmPass === '') {
                messageElement.textContent = 'אנא הזן סיסמה בשני השדות.';
                messageElement.className = 'mt-2 text-sm text-red-500';
                return;
            }

            if (newPass !== confirmPass) {
                messageElement.textContent = 'הסיסמאות אינן תואמות.';
                messageElement.className = 'mt-2 text-sm text-red-500';
            } else {
                websiteData.adminPassword = newPass;
                messageElement.textContent = 'הסיסמה שונתה בהצלחה!';
                messageElement.className = 'mt-2 text-sm text-green-500';
                document.getElementById('admin-new-password').value = '';
                document.getElementById('admin-confirm-password').value = '';
            }
        }

        // --- Drag and Drop Logic ---
        let draggedItem = null;

        function addDragDropListeners(container, dataArray, renderFunction) {
            container.querySelectorAll('div[draggable="true"]').forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    draggedItem = item;
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', item.innerHTML);
                    item.classList.add('opacity-50');
                });

                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    if (item !== draggedItem) {
                        const bounding = item.getBoundingClientRect();
                        const offset = bounding.y + (bounding.height / 2);
                        if (e.clientY < offset) {
                            item.classList.remove('border-b-2', 'border-blue-500');
                            item.classList.add('border-t-2', 'border-blue-500');
                        } else {
                            item.classList.remove('border-t-2', 'border-blue-500');
                            item.classList.add('border-b-2', 'border-blue-500');
                        }
                    }
                });

                item.addEventListener('dragleave', () => {
                    item.classList.remove('border-t-2', 'border-b-2', 'border-blue-500');
                });

                item.addEventListener('drop', (e) => {
                    e.preventDefault();
                    item.classList.remove('border-t-2', 'border-b-2', 'border-blue-500');
                    if (draggedItem !== item) {
                        const draggedIndex = parseInt(draggedItem.dataset.index);
                        const targetIndex = parseInt(item.dataset.index);

                        const [removed] = dataArray.splice(draggedIndex, 1);
                        dataArray.splice(targetIndex, 0, removed);
                        renderFunction(); // רנדר מחדש את הרשימה
                    }
                });

                item.addEventListener('dragend', () => {
                    draggedItem.classList.remove('opacity-50');
                    draggedItem = null;
                    container.querySelectorAll('div[draggable="true"]').forEach(el => {
                        el.classList.remove('border-t-2', 'border-b-2', 'border-blue-500');
                    });
                });
            });
        }


        // --- שמירה והורדה ---
        function saveAndDownloadSite() {
            // שמור את מצב ה-hash הנוכחי כדי לחזור אליו לאחר ההורדה
            const originalHash = window.location.hash;

            // 1. סגור את כל המודאלים ונווט לדף הבית כדי לקבל מצב נקי להורדה
            closeAdminPanel(); // וודא שפאנל הניהול סגור
            closePostModal(); // וודא שמודאל הפוסט סגור
            closeContactModal(); // וודא שמודאל צור קשר סגור
            navigateTo('home'); // נווט לדף הבית

            // עדכן את כל השדות האחרונים לפני שמירה
            updateGeneralSettings();
            updateBlogSettings(); // וודא ששדות הבלוג מעודכנים
            updateKofiSettings(); // וודא ששדות Ko-fi מעודכנים

            // צור עותק של הקוד המקורי של הקובץ
            let fullHtml = document.documentElement.outerHTML;

            // מצא את תג הסקריפט שמכיל את websiteData
            const scriptTagStart = fullHtml.indexOf('// אובייקט נתונים מרכזי של האתר');
            const scriptTagEnd = fullHtml.indexOf('// --- פונקציות עזר כלליות ---'); // סוף ה-websiteData block

            if (scriptTagStart !== -1 && scriptTagEnd !== -1) {
                const beforeData = fullHtml.substring(0, scriptTagStart);
                const afterData = fullHtml.substring(scriptTagEnd);

                // הכנס את הנתונים המעודכנים של websiteData
                // וודא שפאנל הניהול סגור בגרסה שמורידים
                const updatedWebsiteDataString = `        let websiteData = ${JSON.stringify(websiteData, null, 4)};\n`;
                fullHtml = beforeData + updatedWebsiteDataString + afterData;
            } else {
                console.error("Could not find websiteData script block to update.");
                alert("שגיאה בשמירת האתר: לא נמצא בלוק נתוני האתר בקוד.");
                return;
            }

            // צור אובייקט Blob מהקוד המעודכן
            const blob = new Blob([fullHtml], { type: 'text/html' });
            const url = URL.createObjectURL(blob);

            // צור קישור להורדה
            const a = document.createElement('a');
            a.href = url;
            a.download = 'index.html'; // שם הקובץ להורדה
            document.body.appendChild(a);
            a.click(); // הפעל את ההורדה
            document.body.removeChild(a);
            URL.revokeObjectURL(url); // שחרר את ה-URL

            alert('האתר נשמר והורד בהצלחה כ-index.html!');

            // חזור למצב ה-hash המקורי בעמוד הנוכחי (לאחר ההורדה)
            window.location.hash = originalHash;
        }


        // --- אתחול וטיפול ב-Hash ---

        // פונקציה לפתיחת מודאל צור קשר
        function openContactModal() {
            document.getElementById('contact-modal-overlay').classList.remove('hidden');
        }

        // פונקציה לסגירת מודאל צור קשר
        function closeContactModal() {
            document.getElementById('contact-modal-overlay').classList.add('hidden');
        }

        // טען את הדף הנכון בעת טעינת העמוד או שינוי ה-hash
        function handleHashChange() {
            const hash = window.location.hash.substring(1); // הסר את ה-#

            if (hash.startsWith('post-modal-')) {
                const postId = hash.substring('post-modal-'.length);
                // וודא שהמודאל נפתח רק אם הוא לא כבר פתוח עם אותו פוסט
                if (currentPostId !== postId || document.getElementById('post-modal-overlay').classList.contains('hidden')) {
                     openPostModal(postId);
                }
            } else if (hash === 'blog') {
                navigateTo('blog');
            } else {
                navigateTo('home'); // ברירת מחדל: דף הבית
            }
        }

        // האזן לשינויים ב-hash של ה-URL (לחיצה על כפתורי חזרה/קדימה בדפדפן)
        window.addEventListener('hashchange', handleHashChange);

        // טען את הדף הראשוני בעת טעינת העמוד
        document.addEventListener('DOMContentLoaded', loadWebsite);
    </script>
</body>
</html>
